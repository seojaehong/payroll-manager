# Gemini AI Integration Plan

> **Feature**: gemini-integration
> **Created**: 2026-02-04
> **Owner**: Claude Opus 4.5
> **Status**: Planning

---

## Overview

급여 관리 시스템에 Gemini AI를 통합하여 사용자가 AI 도움을 받을 수 있도록 확장합니다.

### 현재 상태 (Already Implemented)

| 기능 | 파일 | 상태 |
|------|------|------|
| 엑셀 컬럼 자동 분석 | `/api/analyze-columns/route.ts` | ✅ 완료 |
| Gemini 2.0 Flash 모델 | `@google/generative-ai` | ✅ 설정됨 |

### 요청된 신규 기능

1. **AI 챗** - 사용자와 대화형 AI 어시스턴트
2. **AI 분석** - 급여 데이터 분석 및 인사이트

---

## Requirements

### 1. AI 챗 기능

**목적**: 급여 관리 관련 질문에 AI가 답변

**기능 요구사항**:
- 플로팅 챗 버튼 (우하단)
- 채팅 모달/사이드바
- 실시간 대화 (스트리밍 응답)
- 대화 히스토리 유지 (세션 내)
- 급여/노무 관련 컨텍스트 제공

**예시 질문**:
- "연장근로수당 계산 방법은?"
- "4대보험 요율이 어떻게 되나요?"
- "이 직원의 퇴직금 예상액은?"
- "급여명세서에 필수 항목은?"

### 2. AI 분석 기능

**목적**: 급여 데이터 자동 분석 및 이상 탐지

**기능 요구사항**:
- 월별 급여 추이 분석
- 이상치 탐지 (급여 급등/급락)
- 4대보험 정합성 검증
- 최저임금 위반 경고
- 근로기준법 준수 체크

**분석 트리거**:
- 급여 데이터 업로드 시 자동 분석
- "AI 분석" 버튼 클릭
- 리포트 생성 시

---

## Technical Design

### API Endpoints

```
POST /api/ai/chat          - 대화형 AI
POST /api/ai/analyze       - 급여 데이터 분석
POST /api/ai/validate      - 데이터 검증
GET  /api/ai/insights      - 인사이트 조회
```

### 기존 코드 재사용

```typescript
// 기존 Gemini 클라이언트 재사용
import { GoogleGenerativeAI } from '@google/generative-ai';
const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY || '');
```

### UI 컴포넌트

1. **AIChatButton** - 플로팅 버튼
2. **AIChatModal** - 채팅 인터페이스
3. **AIAnalysisPanel** - 분석 결과 패널
4. **AIInsightCard** - 인사이트 카드

### State Management

```typescript
// useStore.ts 확장
interface AIState {
  chatHistory: ChatMessage[];
  isAnalyzing: boolean;
  lastAnalysis: AnalysisResult | null;
  insights: Insight[];
}
```

---

## Implementation Order

### Phase 1: AI Chat (우선순위 높음)

1. `/api/ai/chat` 엔드포인트 생성
2. `AIChatButton` 컴포넌트 생성
3. `AIChatModal` 컴포넌트 생성
4. Layout에 AI 버튼 통합
5. 급여/노무 시스템 프롬프트 설정

### Phase 2: AI Analysis

1. `/api/ai/analyze` 엔드포인트 생성
2. `AIAnalysisPanel` 컴포넌트 생성
3. WagesTab에 분석 버튼 추가
4. 분석 결과 저장/조회 기능

### Phase 3: Insights Dashboard

1. 자동 인사이트 생성
2. 대시보드 위젯 추가
3. 알림/경고 시스템

---

## Success Criteria

| 기준 | 목표 |
|------|------|
| AI 챗 응답 시간 | < 3초 |
| 분석 정확도 | > 90% |
| 사용자 만족도 | 긍정 피드백 |
| 에러율 | < 5% |

---

## Risks & Mitigations

| 리스크 | 대응 |
|--------|------|
| API 비용 증가 | 캐싱, 요청 제한 |
| 응답 지연 | 스트리밍, 로딩 UI |
| 부정확한 응답 | 프롬프트 개선, 검증 로직 |
| 개인정보 노출 | 데이터 익명화 |

---

## Dependencies

- `@google/generative-ai` (이미 설치됨)
- `GEMINI_API_KEY` 환경변수 (이미 설정됨)

---

## Notes

- 기존 `/api/analyze-columns`는 엑셀 헤더 분석 전용으로 유지
- 새로운 AI 기능은 `/api/ai/` 네임스페이스 사용
- 스트리밍 응답으로 UX 개선 고려

---

*Generated by PDCA Plan Phase*
