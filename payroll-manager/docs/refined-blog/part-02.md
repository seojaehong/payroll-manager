# 근로복지공단 API 분석: 데이터 설계의 시작점

> **TL;DR**: 4대보험 신고 자동화를 위해 근로복지공단 웹사이트의 API를 분석했습니다. 38개 이상의 입력 필드를 파악하고, 급여대장에서 어떤 데이터를 추출해야 하는지 정리했어요. 사업장-근로자-고용관계를 연결하는 데이터 모델 설계 과정을 공유합니다.

---

## 들어가며: 역설계의 시작

만들려는 시스템의 최종 목적지는 **근로복지공단 취득/상실 신고**입니다.

그렇다면 근로복지공단이 원하는 데이터 형식을 먼저 파악해야 하죠. 마치 퍼즐을 맞추려면 완성된 그림을 먼저 봐야 하는 것처럼요.

브라우저 개발자 도구(F12)를 열고 실제 신고를 진행해봤습니다. Network 탭에서 API 요청을 캡처했어요.

**[캡처 필요 #1]**: 브라우저 개발자 도구 Network 탭에서 API 요청 캡처 화면

---

## 취득신고 API 분석

근로복지공단의 취득신고 API를 분석한 결과입니다.

```
POST /api/v1/total/gaip/wp/saveGeunrojaGySingo
```

### Request Payload (일부)

```json
{
  "jobSeCode": "I",
  "aplcnYmd": "20250130",
  "selAplcnWonbGwanriNo": "XXXXXXXXXXX",
  "inpAplcnDtl": [
    {
      "ihidnum": "XXXXXXXXXXXXX",
      "nm": "홍길동",
      "hnglNm": "Hong Gil Dong",
      "rprsntYn": "N",
      "ntltyCode": "100",
      "soukWlfrm": "2060740",
      "soukJgtkYmd": "20250115",
      "gyWlfrm": "2060740",
      "gyJgtkYmd": "20250115",
      "gyJikjong": "532",
      "gyGnmuwkTm": "40"
    }
  ]
}
```

무려 **38개 이상의 필드**가 있었습니다. 이 중 필수(`*`) 필드만 추려봤어요.

### 필수 필드 정리

| 필드명 | 설명 | 예시 | 출처 |
|--------|------|------|------|
| `ihidnum` | 주민등록번호 | 9501011234567 | 급여대장 |
| `nm` | 성명 | 홍길동 | 급여대장 |
| `rprsntYn` | 대표자여부 | N | 수동입력 |
| `soukWlfrm` | 국민연금 소득월액 | 2060740 | 급여대장 |
| `soukJgtkYmd` | 국민연금 취득일 | 20250115 | 급여대장 |
| `gyWlfrm` | 고용보험 월평균보수 | 2060740 | 급여대장 |
| `gyJgtkYmd` | 고용보험 취득일 | 20250115 | 급여대장 |
| `gyJikjong` | 직종코드 | 532 | 사업장 기본값 |
| `gyGnmuwkTm` | 주소정근로시간 | 40 | 사업장 기본값 |

**핵심 발견**: 대부분의 데이터는 급여대장에서 추출할 수 있고, 일부는 사업장 기본 설정으로 처리 가능합니다.

---

## 급여대장 분석: 현실과 마주하기

실제 사업장의 급여대장을 열어봤습니다. (개인정보는 마스킹)

```
[임금대장] 시트

행1: (빈 행)
행2: (빈 행)
행3: (빈 행)
행4: | 순번 | 이름 | 부서 | 주민등록번호 | 입사일 | 퇴사일 | 계약임금 | ...
행5: (빈 행)
행6: | 1 | 김** | 홀 | 950101-1****** | 2024-03-15 | | 2,200,000 | ...
행7: | 2 | 이** | 주방 | 880515-2****** | 2025-01-10 | | 2,060,740 | ...
```

핵심 정보 위치를 파악했어요.

| 항목 | 위치 |
|------|------|
| 시트명 | `임금대장` |
| 헤더 행 | 4행 |
| 데이터 시작 | 6행 |
| 이름 | B열 (2번째) |
| 주민등록번호 | D열 (4번째) |
| 입사일 | E열 (5번째) |
| 퇴사일 | F열 (6번째) |
| 보수 | G열 (7번째) |

그런데 **문제는 이게 사업장마다 다 다르다는 것**이었습니다.

---

## 데이터 모델 설계: 세 가지 핵심 엔티티

분석 결과를 바탕으로 세 가지 핵심 엔티티를 설계했습니다.

### 1. 사업장 (Business)

사업장 정보와 4대보험 관리번호를 저장합니다.

```typescript
interface Business {
  id: string;
  name: string;           // "OO식당 XX점"
  bizNo: string;          // 사업자등록번호 "123-45-67890"

  // 4대보험 관리번호
  gwanriNo?: string;      // 고용산재 통합 관리번호
  npsGwanriNo?: string;   // 국민연금 관리번호
  nhicGwanriNo?: string;  // 건강보험 관리번호

  // 기본값 (신규 근로자 등록 시 사용)
  defaultJikjong?: string;    // 기본 직종코드 "532"
  defaultWorkHours?: number;  // 기본 근로시간 40
}
```

**설계 포인트**: `defaultJikjong`, `defaultWorkHours`를 사업장별로 설정해두면, 매번 입력할 필요가 없어요.

### 2. 근로자 (Worker)

근로자 개인 정보를 저장합니다.

```typescript
interface Worker {
  id: string;
  name: string;           // 성명
  residentNo: string;     // 주민등록번호 (13자리)
  nationality?: string;   // 국적코드 "100"=한국
  phone?: string;         // 연락처
}
```

### 3. 고용관계 (Employment)

여기가 핵심이에요. 한 근로자가 **여러 사업장에서 일할 수 있고**, **입퇴사를 반복할 수** 있습니다.

```typescript
interface Employment {
  id: string;
  workerId: string;       // 근로자 FK
  businessId: string;     // 사업장 FK

  status: 'ACTIVE' | 'INACTIVE';
  joinDate: string;       // 입사일 "2025-01-15"
  leaveDate?: string;     // 퇴사일
  leaveReason?: string;   // 상실사유코드

  monthlyWage: number;    // 월평균보수
  jikjongCode: string;    // 직종코드
  workHours: number;      // 주소정근로시간

  // 4대보험 가입여부
  gyYn: boolean;          // 고용보험
  sjYn: boolean;          // 산재보험
  npsYn: boolean;         // 국민연금
  nhicYn: boolean;        // 건강보험

  isContract?: boolean;   // 계약직 여부
  contractEndDate?: string;
}
```

---

## 왜 근로자와 고용관계를 분리했나?

처음에는 "근로자 = 고용 정보"로 합치려고 했어요. 하지만 현실은 달랐습니다.

```
김철수 ──┬── A식당 (2023.01 ~ 2023.12) 퇴사
         └── B식당 (2024.01 ~ 현재) 재직중
```

같은 사람이 **여러 곳에서 일하거나**, **퇴사 후 재입사**하는 경우가 흔합니다.

만약 분리하지 않으면:
- 김철수 데이터가 중복됨
- 주민번호로 같은 사람인지 확인해야 함
- 이력 관리가 복잡해짐

분리하면:
- 김철수는 Worker 테이블에 한 번만 저장
- 각 사업장과의 관계는 Employment로 관리
- 이력 추적 용이

---

## ER 다이어그램

전체 데이터 구조를 그림으로 표현하면 이렇습니다.

```
┌─────────────┐       ┌─────────────┐       ┌─────────────┐
│  Business   │       │ Employment  │       │   Worker    │
├─────────────┤       ├─────────────┤       ├─────────────┤
│ id (PK)     │◄──────│ businessId  │       │ id (PK)     │
│ name        │       │ workerId    │──────►│ name        │
│ bizNo       │       │ status      │       │ residentNo  │
│ gwanriNo    │       │ joinDate    │       │ nationality │
│ ...         │       │ leaveDate   │       │ phone       │
└─────────────┘       │ monthlyWage │       └─────────────┘
                      │ 4대보험 Y/N │
      ┌───────────────│ ...         │
      │               └─────────────┘
      │
      ▼
┌─────────────┐
│ ExcelMapping│
├─────────────┤
│ businessId  │
│ sheetName   │
│ headerRow   │
│ columns     │
└─────────────┘
```

**ExcelMapping**은 사업장별로 급여대장 양식이 다르므로, 매핑 정보를 저장하는 테이블입니다. 다음 편에서 자세히 다룹니다.

---

## 엑셀 매핑의 필요성

처음 Import할 때 한 번만 설정하면, 다음부터는 자동으로 인식합니다.

```
30개 사업장 × 매달 반복 = 설정 한 번이 수백 번의 수작업을 줄인다
```

```typescript
interface ExcelMapping {
  businessId: string;
  sheetName: string;      // "임금대장"
  headerRow: number;      // 4
  dataStartRow: number;   // 6
  columns: {
    name: number;         // 이름 열 번호 (2)
    residentNo: number;   // 주민번호 열 번호 (4)
    joinDate: number;     // 입사일 열 번호 (5)
    leaveDate: number;    // 퇴사일 열 번호 (6)
    wage: number;         // 보수 열 번호 (7)
  };
}
```

**[캡처 필요 #2]**: 엑셀 매핑 설정 UI - 시트 선택, 헤더 행, 컬럼 지정 화면

---

## 설계 원칙: 실용적인 선택

이 프로젝트에서 지킨 설계 원칙들입니다.

### 1. 정규화는 적당히

학교에서 배운 대로 완벽하게 정규화하면 테이블이 너무 많아져요. 노무사 업무에 필요한 수준에서 타협했습니다.

### 2. 확장성 고려

처음부터 다중 사업장을 염두에 두고 설계했어요. 덕분에 나중에 15개, 30개로 늘어나도 구조 변경 없이 대응 가능했습니다.

### 3. 현실 데이터 기반

"이론적으로 이게 맞다"보다 "실제 급여대장에 이렇게 들어있다"를 우선했어요. 현실과 동떨어진 설계는 결국 수정이 필요합니다.

---

## 마치며: 설계가 절반이다

데이터 설계에 충분한 시간을 투자했더니, 이후 개발이 훨씬 수월했습니다.

"뭘 저장해야 하지?", "이 데이터는 어디서 가져오지?" 같은 질문에 명확한 답이 있으니, Claude Code에게도 정확한 지시를 내릴 수 있었어요.

다음 편에서는 이 설계를 바탕으로, **실제로 엑셀 파일을 읽고 변환하는 시스템**을 구현합니다.

---

### 다음 편 예고

**[3편] 사업장마다 다른 엑셀 양식을 어떻게 정복했나?**
- xlsx 라이브러리로 엑셀 파일 읽기
- 사업장별 매핑 설정 UI 구현
- 날짜, 주민번호, 금액 파싱의 함정들

---

**관련 키워드**: 4대보험 데이터 설계, 근로복지공단 API, 급여관리 시스템 설계, 노무사 업무 자동화, TypeScript 인터페이스, 데이터 모델링

---

*이 글이 도움이 되셨다면 공유 부탁드립니다. 질문이나 의견은 댓글로 남겨주세요!*
